[gd_scene load_steps=2 format=3 uid="uid://c0p4dwi675set"]

[sub_resource type="CSharpScript" id="CSharpScript_hqml3"]
script/source = "using Godot;

public partial class HighScoreManager : Node
{
	private const string SAVE_FILE = \"user://highscore.save\";
	private static float bestTime = 0.0f;
	private static HighScoreManager instance;
	
	public override void _Ready()
	{
		instance = this;
		LoadHighScore();	}
	
	public static HighScoreManager GetInstance()
	{
		return instance;
	}
	
	public void SaveHighScore(float time)
	{
		if (time > bestTime)
		{
			bestTime = time;
			SaveToFile();
		}
	}
	
	public float GetHighScore()
	{
		return bestTime;
	}
	
	public string GetFormattedHighScore()
	{
		int totalSeconds = Mathf.FloorToInt(bestTime);
		int minutes = (int)(bestTime / 60);
		int seconds = (int)(bestTime % 60);
		return $\"BEST: {minutes:D2}:{seconds:D2}\";
	}
	
	private void SaveToFile()
	{
		var file = FileAccess.Open(SAVE_FILE, FileAccess.ModeFlags.Write);
		if (file != null)
		{
			file.StoreFloat(bestTime);
			file.Close();
		}
	}
	
	private void LoadHighScore()
	{
		var file = FileAccess.Open(SAVE_FILE, FileAccess.ModeFlags.Read);
		if (file != null)
		{
			bestTime = file.GetFloat();
			file.Close();
		}
	}
}
"

[node name="HighScoreManager" type="Node"]
script = SubResource("CSharpScript_hqml3")
